#!/bin/sh

me=$0
[ -L $me ] && me=$(readlink $me)

box_cmd=$1
box_root=$(dirname $me)/..
box_tasks=$box_root/tasks
box_lib=$box_root/lib
box_etc=$box_root/etc
box_par=parallel

export box_cmd box_root box_tasks box_lib box_etc box_hosts box_par

[ -f $box_tasks/$box_cmd ] || {
	echo >&2 "No such task '$box_cmd'. Available tasks:"
	$me tasks >&2
	exit 1
}

$box_par "echo {} | $box_tasks/$box_cmd $2 $3 $4" <$box_etc/hosts
